# Struct & Union 

一般32位机子上各个数据类型所占的存储空间如下：

char：8位 

short：16位

int：32位

long：32位

float：32位

double：64位

## struct，结构体

请牢记以下3条原则：（在没有#pragma pack宏的情况下）

1、数据成员对齐规则：结构体（struct）的数据成员，第一个数据成员放在offset为0的地方，之后的每个数据成员存储的起始位置要从该成员大小的整数倍开始（比如int在32位机子上为4字节，所以要从4的整数倍地址开始存储）。

2、结构体作为成员：如果一个结构体里同时包含结构体成员，则结构体成员要从其内部最大元素大小的整数倍地址开始存储（如struct a里有struct b,b里有char,int ,double等元素，那么b应该从8(即double类型的大小)的整数倍开始存储）。

3、结构体的总大小：即sizeof的结果。在按之前的对齐原则计算出来的大小的基础上，必须还得是其内部最大成员的整数倍，不足的要补齐（如struct里最大为double，现在计算得到的已经是11，则总大小为16）。

```C
typedef struct bb
{
    int id; //[0]....[3] 表示4字节
    double weight; //[8].....[15]　　　　　　原则1
    float height; //[16]..[19],总长要为8的整数倍,仅对齐之后总长为[0]~[19]为20，补齐[20]...[23]　　　　　原则3
}BB;
      size为56
```

## union共用体（联合）

共用体表示几个变量共用一个内存位置，在不同的时间保存不同的数据类型和不同长度的变量。在union中，所有的共用体成员共用一个空间，并且同一时间只能储存其中一个成员变量的值。当一个共用体被声明时, 编译程序自动地产生一个变量, 其长度为联合中元类型（如数组，取其类型的数据长度）最大的变量长度的整数倍，且要大于等于其最大成员所占的存储空间。

```C
union foo
{
char s[10];
int i;
}
```
在这个union中，foo的内存空间的长度为12，是int型的3倍，而并不是数组的长度10。若把int改为double，则foo的内存空间为16，是double型的两倍。

```C
union   mm{  
  char   a;//元长度1        1
  int   b[5];//元长度4     20
  double   c;//元长度8     8
  int   d[3];              12
  };  
```
所以sizeof(mm)=8*3=24；
